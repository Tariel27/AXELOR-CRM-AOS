<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
              xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
              xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_7.1.xsd">
    <cards name="pbp.forum-topic-cards" title="Forum Topics" model="com.axelor.apps.pbproject.db.ForumTopic" width="100%" orderBy="createdOn">
        <field name="title"/>
        <field name="description"/>
        <field name="createdBy"/>
        <field name="createdOn"/>
        <field name="viewCount"/>
        <field name="commentCount"/>
        <field name="tag"/>
        <field name="upvoteCount"/>
        <field name="downvoteCount"/>
        <field name="importance"/>
        <template><![CDATA[

             <div class="span9 card-header" style="background: linear-gradient(135deg, #EAE5C9 0%, #6CC6CB 100%);
             padding: 1.5em;border-radius: 1em; color: #333333; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);">

             <div class="span card-color" style="background: linear-gradient(135deg, {{importance}} 0%, #FFFFE0 100%);
             padding: 0.2em; margin-right:50px; width: 5px; border-radius: 2em; color: #333333;
              box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);">
                        <br><br><br><br><br><br><br><br>
              </div>
              <strong style="font-size: 2.6em; font-weight: bold;">{{title}}</strong>
              <p style="font-size: 1.6em; margin-top: 1.5em; opacity: 0.9;">
                  {{description.length > 30 ? description.substring(0, 30) + '...' : description}}
              </p>
              <br><br>
              </div>
              <div class="span3 card-body" style="background: linear-gradient(135deg, #EAE5C9 0%, #6CC6CB 100%); font-size:
               1.1em; padding: 1.5em; border-radius: 1em; color: #333333; padding-left: 2.5em; box-shadow:
               0 4px 12px rgba(0, 0, 0, 0.1);">
                  <strong>Created by:</strong> {{createdBy.fullName}} <br>
                  <strong>Created on:</strong> {{$fmt('createdOn')}}<br><br>
                  <button type="button" class="btn" style="background-color: #333333; color: white; padding: 0.5em 1.5em;
                   border-radius: 2em; border: none;"
                      ui-action-click="pbp.action-method-for-btn-vote-up-controller" ui-params="{'id': id}">
                      <i class="fa fa-thumbs-up"></i> Like
                  </button>
                  <button type="button" class="btn" style="background-color: #333333; color: white; padding: 0.5em 1.5em;
                  border-radius: 2em; border: none;"
                      ui-action-click="pbp.action-method-for-btn-vote-down-controller" ui-params="{'id': id}">
                      <i class="fa fa-thumbs-down"></i> Dislike
                  </button> <br><br>
                  <strong>Likes:</strong> {{upvoteCount}}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                  <strong>Dislikes:</strong> {{downvoteCount}}<br>
                  <strong>Views:</strong> {{viewCount}}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                  <strong>Post:</strong> {{commentCount}}
              </div>
  ]]></template>
    </cards>


    <form name="pbp.forum-topic-form" title="Forum topic" model="com.axelor.apps.pbproject.db.ForumTopic" width="large" onLoad="pbp.hide-button">
        <panel name="left_panel">
            <field name="title" title="Title" colSpan="12"/>
            <field name="description" title="Description" colSpan="12" widget="html"/>
        </panel>
        <panel sidebar="true">
            <field name="tags" title="Tags" widget="TagSelect"/>
            <panel name="AuthorAndCreatedOn" colSpan="12">
                <field name="createdBy" title="Author" colSpan="6"/>
                <field name="createdOn" title="Created on" readonly="true" colSpan="6"/>
            </panel>
            <panel name="ViewsAndPost" colSpan="12">
                <field name="viewCount" title="Views" readonly="true" colSpan="6"/>
                <field name="commentCount" title="Post" colSpan="6"/>
            </panel>
            <panel name="LikesAndDislikes" colSpan="12">
                <field name="upvoteCount" title="Likes" readonly="true" colSpan="6">
                    <viewer><![CDATA[
    <div style="text-align: center;">
      <span style="color: #28a745; font-weight: bold; font-size: 40px;">{{record.upvoteCount}}</span>
    <div>
  ]]></viewer>
                </field>

                <field name="downvoteCount" title="Dislikes" readonly="true" colSpan="6">
                    <viewer><![CDATA[
        <div style="text-align: center;">
      <span style="color: #dc3545; font-weight: bold; font-size: 40px;">{{record.downvoteCount}}</span>
    <div>
  ]]></viewer>
                </field>
            </panel>
            <panel name="btn" colSpan="12">

                <field name="" colSpan="6">
                    <viewer><![CDATA[
    <button style="background-color: #28a745; width:150px ; color: white; border-radius: 15px; padding: 10px 20px; border: none; cursor: pointer;"
    ui-action-click="pbp.action-method-for-btn-vote-up-controller">
      <i class="fa fa-thumbs-up"></i> Like
    </button>
  ]]></viewer>
                </field>
                <field name="" colSpan="6">
                    <viewer><![CDATA[
    <button style="background-color: #FF0000; width:150px ; color: white; border-radius: 15px; padding: 10px 20px; border: none; cursor: pointer;"
    ui-action-click="pbp.action-method-for-btn-vote-down-controller">
      <i class="fa fa-thumbs-down"></i> Dislike
    </button>
  ]]></viewer>
                </field>

            </panel>
            <field name="importantUsers" title="Users Who Marked as Important" widget="TagSelect"/>
            <button name="importantBtn" title="Important" colSpan="12" width="20" icon="fa-star" onClick="pbp.add-current-user-to-important,save,pbp.hide-button" x-dirty="false"/>
            <field name="importance" title="Importance"/>
        </panel>
        <panel-mail name="mailPanel">
            <mail-messages filter="comment" limit="10000"/>
        </panel-mail>
    </form>


    <form name="pbp.tags-form" title="Tags" model="com.axelor.apps.pbproject.db.Tag" width="mini" onLoad="" cols="12">
        <panel name="left_panel" colSpan="8">
            <field name="name" title="Tag name" colSpan="8"/>

        </panel>

    </form>

    <!--Просмотры-->
    <action-method name="pbp.increment-view-count">
        <call class="com.axelor.apps.pbproject.web.BtnVote"
              method="incrementViewCount"/>
    </action-method>

    <action-method name="pbp.action-method-for-btn-vote-up-controller">
        <call class="com.axelor.apps.pbproject.web.BtnVote"
              method="countVoteUp"/>
    </action-method>
    <action-method name="pbp.action-method-for-btn-vote-down-controller">
        <call class="com.axelor.apps.pbproject.web.BtnVote"
              method="countVoteDown"/>
    </action-method>

    <action-attrs name="pbp.add-current-user-to-important">
        <attribute for="importantUsers" name="value:add" expr="eval: __user__"/>
    </action-attrs>

    <action-attrs name="pbp.hide-button">
        <attribute for="importantBtn" name="hidden" expr="eval: importantUsers.collect{it.id}.contains(__user__.id)"/>
    </action-attrs>

</object-views>